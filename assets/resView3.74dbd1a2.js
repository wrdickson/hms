import{d as Q,i as v,_ as D,l as F,o as m,c as g,w as i,a as o,r as c,b as C,n as K,e as k,t as y,F as T,p as O,f as H,g as p,h as b,j as I,E as N,k as Y,m as x,q as M,s as w,S as G,u as j,v as E,x as A,y as $,z as W,A as J,B as X,C as Z,D as ee,G as te,H as se}from"./index.97875a1f.js";const z=Q({id:"resViewStore",state:()=>({startDate:v().subtract(1,"days").format("YYYY-MM-DD"),showHideRootSpaceCopy:null,scrollLeft:0,scrollTop:0}),actions:{setShowHideRootSpaceCopy(e){console.log("storing rscopy"),this.showHideRootSpaceCopy=e},setStartDate(e){this.startDate=e}}}),le={name:"singelDatePicker",props:["overrideDate"],emits:["singleDatePicker:dateSelected"],data(){return{selectedDate:z().startDate,size:"default"}},computed:{datepickerPlaceholder(){return this.$t("message.datepickerPlaceholder")},locale(){return F().selectedLocale}},watch:{overrideDate(e){this.selectedDate=e},selectedDate(e,t){this.$emit("singleDatePicker:dateSelected",this.selectedDate)}}};function ae(e,t,a,r,s,l){const n=c("el-date-picker"),d=c("el-config-provider");return m(),g(d,{locale:l.locale},{default:i(()=>[o(n,{modelValue:s.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=h=>s.selectedDate=h),type:"date",format:"D-MMM-YYYY",placeholder:l.datepickerPlaceholder,size:s.size},null,8,["modelValue","placeholder","size"])]),_:1},8,["locale"])}const oe=D(le,[["render",ae]]);const ne={props:["isFirst","isLast","resId","start","end","name","span","startTruncated","endTruncated","status"],name:"resBlock",emits:["resBlockClick"],data(){return{}},computed:{classGenerate(){return"resblock-"+this.resId},shortName(){return this.name.length>7?this.name.substring(0,7)+"...":this.name}},methods:{resClicked(e){this.$emit("resBlockClick",e)}}},B=e=>(O("data-v-f87405b0"),e=e(),H(),e),re={key:0},ie=B(()=>p("b",null,"<",-1)),ce=[ie],de={key:1},ue={key:2,class:"float-right"},me=B(()=>p("b",null,">",-1)),he=[me],pe=B(()=>p("span",{class:"sameAsCheckoutBackground"},".",-1)),_e={key:0},fe=B(()=>p("b",null,"<",-1)),ye=[fe],Se={key:1},ge={key:2,class:"float-right"},ve=B(()=>p("b",null,">",-1)),ke=[ve],Ce=B(()=>p("span",{class:"sameAsCheckinBackground"},".",-1));function we(e,t,a,r,s,l){return m(),C(T,null,[a.status==0?(m(),C("div",{key:0,class:K([l.classGenerate,"resBlockCheckedOut res-block"]),onClick:t[0]||(t[0]=n=>l.resClicked(a.resId))},[a.startTruncated&&a.isFirst?(m(),C("span",re,ce)):k("",!0),a.isFirst?(m(),C("span",de,y(l.shortName),1)):k("",!0),a.endTruncated&&a.isLast?(m(),C("span",ue,he)):k("",!0),pe],2)):k("",!0),a.status==1?(m(),C("div",{key:1,class:K([l.classGenerate,"resBlockCheckedIn res-block"]),onClick:t[1]||(t[1]=n=>l.resClicked(a.resId))},[a.startTruncated&&a.isFirst?(m(),C("span",_e,ye)):k("",!0),a.isFirst?(m(),C("span",Se,y(l.shortName),1)):k("",!0),a.endTruncated&&a.isLast?(m(),C("span",ge,ke)):k("",!0),Ce],2)):k("",!0)],64)}const be=D(ne,[["render",we],["__scopeId","data-v-f87405b0"]]);const Re={props:["resIdRef","start","end","span","startTruncated","blockIndicator"],name:"emptyBlock",emits:["empty-block-click"],methods:{emptyBlockClick(){console.log("emptyBlockClick @emptyBlock"),this.$emit("empty-block-click")}}};function Pe(e,t,a,r,s,l){return m(),C("div",{onClick:t[0]||(t[0]=(...n)=>l.emptyBlockClick&&l.emptyBlockClick(...n)),class:"emptyBlock"},[p("span",null,"blocked"+y(a.resIdRef),1)])}const De=D(Re,[["render",Pe]]);const ze={name:"c1",props:["spaceId","showChildren","children"],emits:["c1-toggle-show-children"],computed:{hasChildren(){return this.children.length>0}},methods:{divClick(e){return console.log("divClick",this.spaceId),this.$emit("c1-toggle-show-children",this.spaceId),!1}}},Te={key:0};function xe(e,t,a,r,s,l){const n=c("font-awesome-icon"),d=c("el-button");return m(),C("div",{onClick:t[0]||(t[0]=(...h)=>l.divClick&&l.divClick(...h)),class:"c1-wrapper"},[l.hasChildren?(m(),C("div",Te,[a.showChildren==0?(m(),g(d,{key:0,class:"eButton",type:"primary",plain:"",size:"small"},{default:i(()=>[o(n,{icon:"fa-chevron-right",size:"sm"})]),_:1})):k("",!0),a.showChildren==1?(m(),g(d,{key:1,class:"eButton",type:"primary",plain:"",size:"small"},{default:i(()=>[o(n,{icon:"fa-chevron-down",size:"sm"})]),_:1})):k("",!0)])):k("",!0)])}const Ve=D(ze,[["render",xe],["__scopeId","data-v-b56fffa7"]]);const Ie={name:"ResViewTable",components:{c1:Ve,resBlock:be,emptyBlock:De},emits:["resview-toggle-show-children","resBlockClick","emptyBlockClick","emptyCellClick"],props:["tDateArray","tableData","trigger","resSpaceCopy","tableHeight"],data(){return{}},computed:{spaceLabel(){return this.$t("message.spaceLabel")}},methods:{setInitialScroll(){z().scrollTop>0&&this.setScrollTop(z().scrollTop),z().scrollLeft>0&&this.setScrollLeft(z().scrollLeft)},setScrollLeft(e){this.$refs.resViewTable.$refs.scrollBarRef.setScrollLeft(e)},setScrollTop(e){this.$refs.resViewTable.$refs.scrollBarRef.setScrollTop(e)},c1ToggleShowChildren(e){console.log("resViewTable toggle",e),this.$emit("resview-toggle-show-children",e)},cellClick(e,t){let r=t.property+"resid";if(!e[r]){let s={spaceId:e.id,selectedDate:v(t.property.substr(1)).format("YYYY-MM-DD")};t.property!="description"&&t.property!="expand"&&this.$emit("emptyCellClick",s)}},emptyBlockClick(e,t){console.log("emptyBlockClick on resViewTable",e,t)},getChildrenIds(e){const t=[],a=r=>{let s=b.find(this.resSpaceCopy,l=>l.childOf==r);if(s)b.each(s,l=>{console.log("child",l.id),t.push(l.id),a(l.id)});else return console.log("cArr",t),t};a(e)},resBlockClick(e){this.$emit("resBlockClick",e)},rowStyle(e){if(e.row.childOf>0)return b.find(this.tableData,a=>a.id==e.row.childOf).showChildren==!0?"":"display: none;"}},mounted(){setTimeout(this.setInitialScroll,1),this.$refs.resViewTable.$refs.scrollBarRef.wrapRef.onscroll=e=>{z().scrollLeft=e.target.scrollLeft,z().scrollTop=e.target.scrollTop}},watch:{resSpaceCopy(e,t){console.log("resSpaceCopy change on resViewTable")},tableData(){console.log("tableData wach triggered on resViewTable")},trigger(){console.log("trigger watch on resViewTable",this.trigger)}}},Me={"data-rel-day":"0",style:{display:"flex","align-items":"center"}},Ye={style:{display:"flex","align-items":"center"}};function Ne(e,t,a,r,s,l){const n=c("el-table-column"),d=c("c1"),h=c("resBlock"),f=c("emptyBlock"),S=c("el-table");return m(),g(S,{ref:"resViewTable",data:a.tableData,"row-style":l.rowStyle,height:a.tableHeight,"row-class-name":"resview-row","cell-class-name":"resview-table-cell","header-cell-class-name":"resview-header-cell","header-row-class-name":"resview-header-row",style:{width:"100%",padding:"0px"},onCellClick:l.cellClick,onEmptyBlockClick:l.emptyBlockClick},{default:i(()=>[o(n,{fixed:"",prop:"title",label:l.spaceLabel,width:"120"},null,8,["label"]),o(n,{prop:"expand",fixed:"",width:"27"},{default:i(u=>[p("div",Me,[o(d,{spaceId:u.row.id,showChildren:u.row.showChildren,children:u.row.children,onC1ToggleShowChildren:l.c1ToggleShowChildren},null,8,["spaceId","showChildren","children","onC1ToggleShowChildren"])])]),_:1}),(m(!0),C(T,null,I(a.tDateArray,u=>(m(),g(n,{prop:u.dayString,label:u.dayLabel,width:"90"},{default:i(_=>[p("div",Ye,[_.row[u.dayString+"resid"]?(m(),g(h,{key:0,onResBlockClick:l.resBlockClick,resId:_.row[u.dayString+"resid"],start:_.row[u.dayString+"start"],end:_.row[u.dayString+"end"],name:_.row[u.dayString+"customer"],span:_.row[u.dayString+"span"],startTruncated:_.row[u.dayString+"starttruncated"],endTruncated:_.row[u.dayString+"endtruncated"],isFirst:_.row[u.dayString+"isfirst"],isLast:_.row[u.dayString+"islast"],status:_.row[u.dayString+"status"]},null,8,["onResBlockClick","resId","start","end","name","span","startTruncated","endTruncated","isFirst","isLast","status"])):k("",!0),_.row[u.dayString+"blocked"]?(m(),g(f,{key:1,onEmptyBlockClick:l.emptyBlockClick,resIdRef:_.row[u.dayString+"resIdRef"],start:_.row[u.dayString+"start"],end:_.row[u.dayString+"end"],span:_.row[u.dayString+"span"],startTruncated:_.row[u.dayString+"starttruncated"],endTruncated:_.row[u.dayString+"endtruncated"]},null,8,["onEmptyBlockClick","resIdRef","start","end","span","startTruncated","endTruncated"])):k("",!0)])]),_:2},1032,["prop","label"]))),256))]),_:1},8,["data","row-style","height","onCellClick","onEmptyBlockClick"])}const Fe=D(Ie,[["render",Ne]]),Be={name:"DateRangePicker",props:["componentKey","initialStart","initialEnd"],emits:["dateRangePicker:rangeSelected","dateRangePicker:clearDates"],data(){return{dRange:null}},computed:{endDate(){return this.dRange?v(this.dRange[1]).format("YYYY-MM-DD"):null},endPlaceholder(){return this.$t("message.endDate")},labelDates(){return this.$t("message.dates")},locale(){return F().selectedLocale},rSeperator(){return this.$t("message.to")},startDate(){return this.dRange?v(this.dRange[0]).format("YYYY-MM-DD"):null},startPlaceholder(){return this.$t("message.startDate")}},mounted(){this.initialStart&&this.initialEnd&&(this.dRange=[this.initialStart,this.initialEnd])},watch:{componentKey(e){this.dRange=null,this.$emit("dateRangePicker:rangeSelected",[null,null])},dRange(e,t){if(this.startDate!=null&&this.endDate!=null)if(this.startDate==this.endDate)N({type:"warning",message:"Start and end must be different"}),this.$emit("dateRangePicker:clearDates");else{const a=[v(this.dRange[0]).format("YYYY-MM-DD"),v(this.dRange[1]).format("YYYY-MM-DD")];this.$emit("dateRangePicker:rangeSelected",a)}}}};function Ee(e,t,a,r,s,l){const n=c("el-date-picker"),d=c("el-form-item"),h=c("el-form"),f=c("el-config-provider");return m(),C("div",null,[o(f,{locale:l.locale},{default:i(()=>[o(h,{"label-width":"120px",size:"small"},{default:i(()=>[o(d,{label:l.labelDates},{default:i(()=>[o(n,{modelValue:s.dRange,"onUpdate:modelValue":t[0]||(t[0]=S=>s.dRange=S),type:"daterange",size:"small",format:"D-MMM-YYYY",clearable:!1,"range-separator":l.rSeperator,"start-placeholder":l.startPlaceholder,"end-placeholder":l.endPlaceholder},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),_:1})]),_:1},8,["locale"])])}const Le=D(Be,[["render",Ee]]),Ke={name:"RootSpacePicker",props:["availableSpaceIds","componentKey"],emits:["rootSpacePicker:spaceSelected"],data(){return{rootSpaces:null,selectedRootSpace:null}},computed:{availableSpaces(){if(this.rootSpaces&&this.availableSpaceIds){let e=[];return b.each(this.rootSpaces,t=>{b.includes(this.availableSpaceIds,t.id)&&e.push(t)}),e}else return[]},initialSpaceIdSelected(){return!!this.selectedSpaceId},labelSpace(){return this.$t("message.spaceLabel")},locale(){return this.$i18n},placeholder(){return this.$t("message.select")},token(){return Y().token}},created(){x.rootSpaces.getRootSpaces(this.token).then(e=>{this.rootSpaces=e.data.root_spaces_children_parents})},watch:{componentKey(e){console.log("cKey on rSP"),this.selectedRootSpace=null},selectedRootSpace(e,t){this.$emit("rootSpacePicker:spaceSelected",this.selectedRootSpace)},availableSpaceIds(e,t){this.selectedRootSpace=null}}};function Ae(e,t,a,r,s,l){const n=c("el-option"),d=c("el-select"),h=c("el-config-provider"),f=c("el-form-item"),S=c("el-form");return m(),C("div",null,[o(S,{"label-width":"120px",size:"small",class:"cust-form"},{default:i(()=>[o(f,{label:l.labelSpace},{default:i(()=>[o(h,{locale:l.locale},{default:i(()=>[s.rootSpaces?(m(),g(d,{key:0,modelValue:s.selectedRootSpace,"onUpdate:modelValue":t[0]||(t[0]=u=>s.selectedRootSpace=u),placeholder:l.placeholder},{default:i(()=>[(m(!0),C(T,null,I(l.availableSpaces,u=>(m(),g(n,{label:u.title,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])):k("",!0)]),_:1},8,["locale"])]),_:1},8,["label"])]),_:1})])}const qe=D(Ke,[["render",Ae]]),Ue={name:"SearchCustomers",props:["componentKey"],emits:["searchCustomers:customerSelected"],data(){return{customers:[],form:{firstName:"",lastName:""},currentPage:1,pageSize:10,rowCount:0}},computed:{labelCustomer(){return this.$t("message.customer")},labelFirstName(){return this.$t("message.firstName")},labelLastName(){return this.$t("message.lastName")},offset(){return(this.currentPage-1)*this.pageSize},token(){return Y().token}},methods:{searchC(){try{x.customers.searchCustomers(this.form.lastName,this.form.firstName,this.token,this.offset,this.pageSize).then(e=>{console.log(e.data),this.customers=e.data.customers,this.rowCount=e.data.count}).catch(e=>{M({message:e,type:"warning"})})}catch{M({message:"Error requesting data from server",type:"warning"})}},selectCustomer(e){this.$emit("searchCustomers:customerSelected",e)}},watch:{componentKey(e){this.form.firstName="",this.form.lastName="",this.rowCount=0,this.customers=[]},currentPage(e){this.currentPage=e},offset(e){this.searchC()},pageSize(e){this.searchC()}}};function Qe(e,t,a,r,s,l){const n=c("el-input"),d=c("el-col"),h=c("el-form-item"),f=c("el-button"),S=c("el-form"),u=c("el-table-column"),_=c("el-table"),P=c("el-pagination"),V=c("el-config-provider");return m(),g(V,null,{default:i(()=>[o(S,{"label-width":"120px",size:"small"},{default:i(()=>[o(h,{label:l.labelCustomer},{default:i(()=>[o(d,{span:11},{default:i(()=>[o(n,{modelValue:s.form.lastName,"onUpdate:modelValue":t[0]||(t[0]=R=>s.form.lastName=R),placeholder:l.labelLastName},null,8,["modelValue","placeholder"])]),_:1}),o(d,{span:11},{default:i(()=>[o(n,{modelValue:s.form.firstName,"onUpdate:modelValue":t[1]||(t[1]=R=>s.form.firstName=R),placeholder:l.labelFirstName},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["label"]),o(h,null,{default:i(()=>[o(f,{type:"primary",onClick:l.searchC},{default:i(()=>[w(y(e.$t("message.searchCustomers")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),o(_,{data:s.customers,size:"small",style:{width:"100%"},height:"200px",onRowClick:l.selectCustomer},{default:i(()=>[o(u,{fixed:"",prop:"last_name",label:l.labelLastName,width:"100"},null,8,["label"]),o(u,{fixed:"",prop:"first_name",label:l.labelFirstName,width:"100"},null,8,["label"]),o(u,{prop:"email",label:"Email",width:"120"}),o(u,{prop:"address1",label:"Address 1",width:"120"}),o(u,{prop:"address2",label:"Address 2",width:"120"}),o(u,{prop:"city",label:"City",width:"120"}),o(u,{prop:"region",label:"Region",width:"120"}),o(u,{prop:"country",label:"Country",width:"120"}),o(u,{prop:"postalCode",label:"PostalCode",width:"120"})]),_:1},8,["data","onRowClick"]),o(P,{"current-page":s.currentPage,"onUpdate:current-page":t[2]||(t[2]=R=>s.currentPage=R),"page-size":s.pageSize,"onUpdate:page-size":t[3]||(t[3]=R=>s.pageSize=R),background:"",layout:"sizes, prev, pager, next",total:s.rowCount,"page-sizes":[1,10,20,30,40,50]},null,8,["current-page","page-size","total"])]),_:1})}const q=D(Ue,[["render",Qe]]);G.warning=function(){};const Oe={name:"CreateCustomer",props:["componentKey"],emits:["createCustomer:customerCreated"],data(){return{customerForm:{firstName:"",lastName:"",email:"",phone:""},rules:{firstName:[{required:!0,message:()=>this.$t("message.firstNameIsRequired")},{min:1,max:24,message:"1 to 24"}],lastName:[{required:!0,message:()=>this.$t("message.lastNameIsRequired")},{min:2,max:24,message:"2 to 24"}],email:[{type:"email",message:()=>this.$t("message.enterCorrectEmail")}],phone:[{pattern:/^\+?\d{1,4}?[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/,message:"enter a correct phone"}]}}},computed:{labelEmail(){return this.$t("message.email")},labelFirstName(){return this.$t("message.firstName")},labelLastName(){return this.$t("message.lastName")},labelPhone(){return this.$t("message.phone")},locale(){return F().selectedLocale},token(){return Y().token}},methods:{submitForm(e){this.$refs[e].validate(t=>{if(t)x.customers.createCustomer(this.token,this.customerForm.lastName,this.customerForm.firstName,this.customerForm.email,this.customerForm.phone).then(a=>{console.log(a),a.data.createCustomer&&a.data.newCustomer&&this.$emit("createCustomer:customerCreated",a.data.newCustomer)});else return console.log("error submit!!"),!1})},resetForm(e){this.$refs[e].resetFields()}},watch:{componentKey(e){this.customerForm.firstName="",this.customerForm.lastName="",this.customerForm.email="",this.customerForm.phone=""}}};function He(e,t,a,r,s,l){const n=c("el-input"),d=c("el-form-item"),h=c("el-button"),f=c("el-form"),S=c("el-config-provider");return m(),g(S,{locale:l.locale},{default:i(()=>[o(f,{model:s.customerForm,rules:s.rules,size:"small",ref:"createCustomerForm","label-width":"120px"},{default:i(()=>[o(d,{label:l.labelFirstName,prop:"firstName"},{default:i(()=>[o(n,{modelValue:s.customerForm.firstName,"onUpdate:modelValue":t[0]||(t[0]=u=>s.customerForm.firstName=u)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,{label:l.labelLastName,prop:"lastName"},{default:i(()=>[o(n,{modelValue:s.customerForm.lastName,"onUpdate:modelValue":t[1]||(t[1]=u=>s.customerForm.lastName=u)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,{label:l.labelEmail,prop:"email"},{default:i(()=>[o(n,{modelValue:s.customerForm.email,"onUpdate:modelValue":t[2]||(t[2]=u=>s.customerForm.email=u)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,{label:l.labelPhone,prop:"phone"},{default:i(()=>[o(n,{modelValue:s.customerForm.phone,"onUpdate:modelValue":t[3]||(t[3]=u=>s.customerForm.phone=u)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,null,{default:i(()=>[o(h,{type:"primary",onClick:t[4]||(t[4]=u=>l.submitForm("createCustomerForm"))},{default:i(()=>[w(y(e.$t("message.createCustomer")),1)]),_:1}),o(h,{onClick:t[5]||(t[5]=u=>l.resetForm("createCustomerForm"))},{default:i(()=>[w(y(e.$t("message.reset")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["locale"])}const U=D(Oe,[["render",He]]),Ge={name:"ResBedsPicker",props:["componentKey","initialBedsQty"],emits:["resBedsPicker:bedQtyChosen"],data(){return{arr:[1,2,3,4,5,6,7,8,9,10],selectedBedQty:null}},computed:{labelNumberOfBeds(){return this.$t("message.numberOfBeds")},locale(){return this.$i18n},placeholder(){return this.$t("message.select")}},mounted(){this.initialBedsQty&&(this.selectedBedQty=this.initialBedsQty)},watch:{componentKey(e){this.selectedBedQty=null},selectedBedQty(e,t){this.$emit("resBedsPicker:bedQtyChosen",this.selectedBedQty)}}};function je(e,t,a,r,s,l){const n=c("el-option"),d=c("el-select"),h=c("el-form-item"),f=c("el-form"),S=c("el-config-provider");return m(),C("div",null,[o(S,null,{default:i(()=>[o(f,{"label-width":"120px",size:"small"},{default:i(()=>[o(h,{label:l.labelNumberOfBeds},{default:i(()=>[o(d,{modelValue:s.selectedBedQty,"onUpdate:modelValue":t[0]||(t[0]=u=>s.selectedBedQty=u),placeholder:l.placeholder},{default:i(()=>[(m(!0),C(T,null,I(s.arr,u=>(m(),g(n,{label:u,value:u},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})])}const $e=D(Ge,[["render",je]]),We={name:"ResPeoplePicker",props:["componentKey","initialPeopleQty"],emits:["resPeoplePicker:peopleQtyChosen"],data(){return{arr:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],selectedPeopleQty:null}},computed:{labelPeople(){return this.$t("message.people")},locale(){return F().selectedLocale},placeholder(){return this.$t("message.select")}},mounted(){this.initialPeopleQty&&(this.selectedPeopleQty=this.initialPeopleQty)},watch:{componentKey(e,t){console.log("componentKey change on resPoeplePic",t),this.selectedPeopleQty=null},selectedPeopleQty(e,t){console.log(this.$i18n),this.$emit("resPeoplePicker:peopleQtyChosen",this.selectedPeopleQty)}}};function Je(e,t,a,r,s,l){const n=c("el-option"),d=c("el-select"),h=c("el-form-item"),f=c("el-form"),S=c("el-config-provider");return m(),C("div",null,[o(S,{locale:l.locale},{default:i(()=>[o(f,{"label-width":"120px",size:"small"},{default:i(()=>[o(h,{label:l.labelPeople},{default:i(()=>[o(d,{modelValue:s.selectedPeopleQty,"onUpdate:modelValue":t[0]||(t[0]=u=>s.selectedPeopleQty=u),placeholder:l.placeholder},{default:i(()=>[(m(!0),C(T,null,I(s.arr,u=>(m(),g(n,{label:u,value:u},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1},8,["locale"])])}const Xe=D(We,[["render",Je]]),L=()=>{const e=()=>{Y().setAccountToGuest(),j.push({path:"/Login"})};return{handleRequestError:a=>{if(a)if(a.response)if(a.response.status)switch(a.response.status){case 400:M({title:"Error 400 - Bad Request",duration:0,message:"The request was malformed.  Request was not processed",type:"error"});break;case 401:M({title:"Error 401 - Unauthorized",duration:4500,message:"Authorization failed.  Request was not processed.",type:"error",onClose:e});break;case 403:M({title:"Error 403 - Forbidden",duration:0,message:"You are not allowed to perform this task.  Request was not processed",type:"error",onClose:e});break;case 404:M({title:"Error 404 - Not found",duration:4500,message:"The location of this this request was not found",type:"error"});case 500:M({title:"Server Error",duration:4500,message:"There was an error on the server.  Request was not processed",type:"error"});break;default:M({title:"Error",duration:4500,message:"There was an error.  Request was not processed",type:"error"})}else M({title:"Error",duration:4500,message:"There was an error.  Request was not processed",type:"error"});else M({title:"Error",duration:0,message:"There was an error 1.  Request was not processed",type:"error"});else M({title:"Error",duration:0,message:"There was an error 2.  Request was not processed",type:"error"})}}},Ze={setup(){const{handleRequestError:e}=L();return{handleRequestError:e}},name:"CreateReservation",emits:["createReservation:reloadReservations","createReservation:closeDrawer"],components:{DateRangePicker:Le,RootSpacePicker:qe,SearchCustomers:q,CreateCustomer:U,ResBedsPicker:$e,ResPeoplePicker:Xe},data(){return{availableSpaceIds:null,selectedCustomer:null,showCreateCustomer:!1,showSearchCustomers:!1,startDate:null,endDate:null,selectedSpaceId:null,selectedPeople:null,selectedBeds:null,componentKey:0}},computed:{labelCustomer(){return this.$t("message.customer")},fStartDate(){return this.startDate?v(this.startDate).format("YYYY-MM-DD"):null},fEndDate(){return this.endDate?v(this.endDate).format("YYYY-MM-DD"):null},token(){return Y().token}},methods:{bedQtyChosen(e){console.log("gotem beds on create res",e),this.selectedBeds=e},checkConflicts(){x.reservations.checkConflicts(this.fStartDate,this.fEndDate,this.selectedSpaceId,this.token).then(e=>{console.log(e)}).catch(e=>{handleError(e)})},createReservation(){x.reservations.createReservation(this.token,this.fStartDate,this.fEndDate,this.selectedCustomer,this.selectedSpaceId,this.selectedPeople,this.selectedBeds).then(e=>{e.data.create.execute_res_sql==!0&&(N({type:"success",message:"Reservation was created"}),this.$emit("createReservation:reloadReservations"),this.resetForm())}).catch(e=>{console.log("error",e),this.handleRequestError(e)})},customerSelected(e){console.log(e),this.selectedCustomer=e},dRangeClearDates(){this.startDate=null,this.endDate=null,this.availableSpaceIds=null},dRangeSelected(e){console.log("dRange @ change on createres",e),e[0]&&e[1]?(this.startDate=e[0],this.endDate=e[1],x.reservations.checkAvailabilityByDates(this.fStartDate,this.fEndDate,this.token).then(t=>{console.log(t.data),this.availableSpaceIds=t.data.availability.availableSpaceIds})):(this.availableSpaceIds=[],this.startDate=null,this.endDate=null)},peopleQtyChosen(e){console.log("people chosen: ",e),this.selectedPeople=e},resetForm(){this.componentKey+=1,this.availableSpaceIds=[],this.selectedCustomer=null,this.showCreateCustomer=!1,this.showSearchCustomers=!1},spaceSelected(e){console.log(e),this.selectedSpaceId=e}}},et=p("hr",null,null,-1),tt={key:0},st={key:0},lt=p("hr",null,null,-1),at=p("hr",null,null,-1);function ot(e,t){const a=c("el-button"),r=c("el-form-item"),s=c("el-form"),l=c("SearchCustomers"),n=c("CreateCustomer"),d=c("ResPeoplePicker"),h=c("ResBedsPicker"),f=c("DateRangePicker"),S=c("RootSpacePicker"),u=c("el-col"),_=c("el-row");return m(),g(_,null,{default:i(()=>[o(u,null,{default:i(()=>[p("h1",null,y(e.$t("message.createReservation")),1),o(a,{type:"primary",size:"small",onClick:e.resetForm},{default:i(()=>[w("Reset Form")]),_:1},8,["onClick"]),et,p("div",null,[p("span",null,[e.selectedCustomer?(m(),C("span",tt,[w(y(e.$t("message.customer"))+":\xA0",1),p("b",null,y(e.selectedCustomer.first_name)+"\xA0"+y(e.selectedCustomer.last_name),1)])):k("",!0),e.selectedCustomer?(m(),g(a,{key:1,type:"warning",size:"small",style:{float:"right"},onClick:t[0]||(t[0]=P=>{e.selectedCustomer=null,e.showSearchCustomers=null,e.showCreateCustomer=null})},{default:i(()=>[w(y(e.$t("message.reset")),1)]),_:1})):k("",!0)])]),p("div",null,[e.selectedCustomer?k("",!0):(m(),C("span",st,[o(s,{size:"small"},{default:i(()=>[o(r,{label:e.labelCustomer},{default:i(()=>[o(a,{size:"small",type:"primary",onClick:t[1]||(t[1]=P=>{e.showSearchCustomers=!0,e.showCreateCustomer=!1})},{default:i(()=>[w(y(e.$t("message.search")),1)]),_:1}),o(a,{size:"small",type:"primary",onClick:t[2]||(t[2]=P=>{e.showCreateCustomer=!0,e.showSearchCustomers=!1})},{default:i(()=>[w(y(e.$t("message.create")),1)]),_:1})]),_:1},8,["label"])]),_:1})]))]),e.showSearchCustomers&&!e.selectedCustomer?(m(),g(l,{key:0,componentKey:e.componentKey,"onSearchCustomers:customerSelected":e.customerSelected},null,8,["componentKey","onSearchCustomers:customerSelected"])):k("",!0),e.showCreateCustomer&&!e.selectedCustomer?(m(),g(n,{key:1,componentKey:e.componentKey,"onCreateCustomer:customerCreated":e.customerSelected},null,8,["componentKey","onCreateCustomer:customerCreated"])):k("",!0),lt,o(d,{componentKey:e.componentKey,"onResPeoplePicker:peopleQtyChosen":e.peopleQtyChosen},null,8,["componentKey","onResPeoplePicker:peopleQtyChosen"]),o(h,{componentKey:e.componentKey,"onResBedsPicker:bedQtyChosen":e.bedQtyChosen},null,8,["componentKey","onResBedsPicker:bedQtyChosen"]),o(f,{componentKey:e.componentKey,"onDateRangePicker:rangeSelected":e.dRangeSelected,"onDateRangePicker:clearDates":e.dRangeClearDates},null,8,["componentKey","onDateRangePicker:rangeSelected","onDateRangePicker:clearDates"]),e.availableSpaceIds?(m(),g(S,{key:2,componentKey:e.componentKey,availableSpaceIds:e.availableSpaceIds,"onRootSpacePicker:spaceSelected":e.spaceSelected},null,8,["componentKey","availableSpaceIds","onRootSpacePicker:spaceSelected"])):k("",!0),at,e.startDate&&e.endDate&&e.selectedCustomer&&e.selectedSpaceId&&e.selectedPeople&&e.selectedBeds?(m(),g(r,{key:3},{default:i(()=>[o(a,{type:"primary",size:"small",onClick:e.createReservation},{default:i(()=>[w(y(e.$t("message.createReservation")),1)]),_:1},8,["onClick"]),o(a,{type:"primary",size:"small",onClick:e.checkConflicts},{default:i(()=>[w(y(e.$t("message.availability")),1)]),_:1},8,["onClick"])]),_:1})):k("",!0)]),_:1})]),_:1})}const nt=D(Ze,[["render",ot]]),rt={name:"EditReservation",props:["componentKey","resId","checkin","checkout","people","beds","spaceId","customer","customerFirst","customerLast"],emits:["edit-reservation:modify-reservation-1"],components:{SearchCustomers:q,CreateCustomer:U},data(){return{cResId:this.resId,cCheckin:this.checkin,cCheckout:this.checkout,cPeople:this.people,cBeds:this.beds,cSpaceId:this.spaceId,cCustomer:this.customer,cCustomerFirst:this.customerFirst,cCustomerLast:this.customerLast,componentKey2:0,availableSpaceIds:[],availableSpaces:[],rootSpaces:null,showCreateCustomer:!1,showSearchCustomers:!1,selectedSpace:"",bedsSelectArr:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],peopleSelectArr:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]}},computed:{bedsPickerLabel(){return this.$t("message.beds")},cCheckinF(){return v(this.cDateRange[0]).format("YYYY-MM-DD")},cCheckoutF(){return v(this.cDateRange[1]).format("YYYY-MM-DD")},cDateRange:{get(){return[this.cCheckin,this.cCheckout]},set(e){this.cCheckin=v(e[0]).format("YYYY-MM-DD"),this.cCheckout=v(e[1]).format("YYYY-MM-DD")}},editReady(){return!!this.selectedSpace},locale(){return F().selectedLocale},token(){return Y().token},peoplePickerLabel(){return this.$t("message.people")},placeholder(){return this.$t("message.select")},rangePickerEndPlaceholder(){return this.$t("message.endDate")},rangePickerLabelDates(){return this.$t("message.dates")},rangePickerSeperator(){return this.$t("message.to")},rangePickerStartPlaceholder(){return this.$t("message.startDate")},spacePickerLabel(){return this.$t("message.spaceLabel")}},methods:{createCustomerSelected(e){console.log("cust created",e),this.cCustomer=e.id,this.cCustomerFirst=e.firstName,this.cCustomerLast=e.lastName,this.componentKey+=1,this.showCreateCustomer=!1},loadAvailableSpaces(){let e=[];b.each(this.rootSpaces,t=>{b.includes(this.availableSpaceIds,t.id)&&e.push(t)}),console.log("av Sp",e),this.availableSpaces=e},loadAvailableSpaceIds(){x.reservations.checkAvailabilityByDatesIgnoreRes(this.resId,this.cCheckinF,this.cCheckoutF,this.token).then(e=>{console.log(e),this.availableSpaceIds=e.data.availableSpaceIds,this.loadAvailableSpaces(),this.selectedSpace=null})},revertToProps(){this.cCheckin=this.checkin,this.cCheckout=this.checkout,this.cPeople=this.people,this.cBeds=this.beds,this.cCustomer=this.customer,this.cCustomerFirst=this.customerFirst,this.cCustomerLast=this.customerLast,this.selectedSpace=null,this.showSearchCustomers=!1,this.showCreateCustomer=!1},searchCustomerSelected(e){console.log(e),this.cCustomer=e.id,this.cCustomerFirst=e.firstName,this.cCustomerLast=e.lastName,this.componentKey2+=1,this.showSearchCustomers=!1},updateReservation(){const e={res_id:this.cResId,customer:this.cCustomer,space_id:this.selectedSpace,people:this.cPeople,beds:this.cBeds,checkin:this.cCheckinF,checkout:this.cCheckoutF};this.$emit("edit-reservation:modify-reservation-1",e)}},mounted(){x.reservations.checkAvailabilityByDatesIgnoreRes(this.resId,this.checkin,this.checkout,this.token).then(e=>{console.log(e),this.availableSpaceIds=e.data.availableSpaceIds,this.rootSpaces=E().rootSpaces,this.loadAvailableSpaces()})},watch:{componentKey(e){this.revertToProps()},resId(e){this.cResId=e},checkin(e){this.cCheckin=e},checkout(e){this.cCheckout=e},people(e){this.cPeople=e},beds(e){this.cBeds=e},spaceId(e){this.cSpaceId=e},customer(e){this.cCustomer=e},customerFirst(e){this.cCustomerFirst=e},customerLast(e){this.cCustomerLast=e},cDateRange(e){console.log("cDateRange change",e),this.loadAvailableSpaceIds()}}},it={key:0},ct=p("hr",null,null,-1),dt=p("hr",null,null,-1);function ut(e,t,a,r,s,l){const n=c("el-button"),d=c("SearchCustomers"),h=c("CreateCustomer"),f=c("el-option"),S=c("el-select"),u=c("el-form-item"),_=c("el-date-picker"),P=c("el-form"),V=c("el-config-provider");return s.rootSpaces?(m(),C("div",it,[ct,p("div",null," Customer: "+y(s.cCustomerFirst)+"\xA0"+y(s.cCustomerLast),1),p("div",null,[o(n,{onClick:t[0]||(t[0]=R=>(s.showSearchCustomers=!0,s.showCreateCustomer=!1)),size:"small"},{default:i(()=>[w(y(e.$t("message.searchCustomers")),1)]),_:1}),s.showSearchCustomers?(m(),g(n,{key:0,onClick:t[1]||(t[1]=R=>s.showSearchCustomers=!1),size:"small"},{default:i(()=>[w("cancel")]),_:1})):k("",!0)]),p("div",null,[o(n,{onClick:t[2]||(t[2]=R=>(s.showCreateCustomer=!0,e.createCustomer=!1)),size:"small"},{default:i(()=>[w(y(e.$t("message.createCustomer")),1)]),_:1}),s.showCreateCustomer?(m(),g(n,{key:0,onClick:t[3]||(t[3]=R=>s.showCreateCustomer=!1),size:"small"},{default:i(()=>[w("cancel")]),_:1})):k("",!0)]),s.showSearchCustomers?(m(),g(d,{key:0,componentKey:s.componentKey2,"onSearchCustomers:customerSelected":l.searchCustomerSelected},null,8,["componentKey","onSearchCustomers:customerSelected"])):k("",!0),s.showCreateCustomer?(m(),g(h,{key:1,componentKey:s.componentKey2,"onCreateCustomer:customerCreated":l.createCustomerSelected},null,8,["componentKey","onCreateCustomer:customerCreated"])):k("",!0),dt,o(V,{locale:l.locale},{default:i(()=>[o(P,{"label-width":"70px",size:"small"},{default:i(()=>[o(u,{label:l.peoplePickerLabel},{default:i(()=>[o(S,{modelValue:s.cPeople,"onUpdate:modelValue":t[4]||(t[4]=R=>s.cPeople=R),placeholder:l.placeholder},{default:i(()=>[(m(!0),C(T,null,I(s.peopleSelectArr,R=>(m(),g(f,{label:R,value:R},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.bedsPickerLabel},{default:i(()=>[o(S,{modelValue:s.cBeds,"onUpdate:modelValue":t[5]||(t[5]=R=>s.cBeds=R),placeholder:l.placeholder},{default:i(()=>[(m(!0),C(T,null,I(s.bedsSelectArr,R=>(m(),g(f,{label:R,value:R},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(u,{label:l.rangePickerLabelDates},{default:i(()=>[o(_,{modelValue:l.cDateRange,"onUpdate:modelValue":t[6]||(t[6]=R=>l.cDateRange=R),type:"daterange",size:"small",format:"D-MMM-YYYY",clearable:!1,"range-separator":l.rangePickerSeperator,"start-placeholder":l.rangePickerStartPlaceholder,"end-placeholder":l.rangePickerEndPlaceholder},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"])]),_:1},8,["label"]),o(u,{label:l.spacePickerLabel},{default:i(()=>[this.rootSpaces&&this.cSpaceId&&this.availableSpaceIds?(m(),g(S,{key:0,modelValue:this.selectedSpace,"onUpdate:modelValue":t[7]||(t[7]=R=>this.selectedSpace=R),placeholder:l.placeholder},{default:i(()=>[(m(!0),C(T,null,I(this.availableSpaces,R=>(m(),g(f,{label:R.title,value:R.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])):k("",!0)]),_:1},8,["label"])]),_:1})]),_:1},8,["locale"]),p("div",null,[l.editReady?(m(),g(n,{key:0,onClick:l.updateReservation,type:"success"},{default:i(()=>[w("Save")]),_:1},8,["onClick"])):k("",!0),o(n,{onClick:l.revertToProps,type:"info"},{default:i(()=>[w("revert")]),_:1},8,["onClick"])])])):k("",!0)}const mt=D(rt,[["render",ut]]),ht={name:"ProcessSaleType",props:["saleType","processSaleTypeResetKey"],emits:["process-sale-type:add-sale-item"],data(){return{description:"",saleQuantities:[-5,-4,-3,-2,-1,1,2,3,4,5],iSale:null}},computed:{subtotal(){return Number(this.iSale.price*this.iSale.quantity).toFixed(2)},saleTotal(){return this.iSale&&this.subtotal&&this.totalTax?Number(Number(this.subtotal)+Number(this.totalTax)).toFixed(2):null},saleTypes(){return A().saleTypes},taxRate(){if(this.iSale){const e=this.iSale.tax_types;let t=0;return b.each(e,a=>{const r=b.find(this.taxTypes,s=>s.id==a);t=Number(t)+Number(r.tax_rate)}),Number(t)}else return null},taxSpread(){if(this.iSale&&this.subtotal){let e=[];return b.each(this.iSale.tax_types,t=>{let a={};const r=b.find(this.taxTypes,s=>s.id==t);a.i=t,a.r=r.tax_rate,a.t=Number(r.tax_rate*this.subtotal).toFixed(2),e.push(a)}),e}else return null},taxTypes(){return $().taxTypes},totalTax(){return this.taxRate!=null?(this.subtotal*Number(this.taxRate)).toFixed(2):null}},methods:{addToSale(){const e={saleType:this.iSale.id,saleTitle:this.iSale.title,saleQuantity:this.iSale.quantity,salePrice:this.iSale.price,saleSubtotal:this.subtotal,saleTax:this.totalTax,saleTotal:this.saleTotal,taxTypes:this.iSale.tax_types,taxSpread:this.taxSpread,description:this.iSale.description};this.$emit("process-sale-type:add-sale-item",e)}},watch:{saleType(e){console.log("watch on process sale type",e),e?(e.quantity=1,e.description=e.title,e.is_fixed_price?e.price=e.fixed_price:e.price=null,this.iSale=e):this.iSale=null}}},pt={class:"process-sale-wrapper"};function _t(e,t,a,r,s,l){const n=c("el-input"),d=c("el-form-item"),h=c("el-option"),f=c("el-select"),S=c("el-form"),u=c("el-button");return m(),C("div",pt,[s.iSale?(m(),g(S,{key:0,size:"small",inline:!0,"label-position":"top"},{default:i(()=>[o(d,{label:"Type"},{default:i(()=>[o(n,{disabled:"",modelValue:s.iSale.title,"onUpdate:modelValue":t[0]||(t[0]=_=>s.iSale.title=_)},null,8,["modelValue"])]),_:1}),o(d,{label:"Qty",style:{width:"60px"}},{default:i(()=>[o(f,{modelValue:s.iSale.quantity,"onUpdate:modelValue":t[1]||(t[1]=_=>s.iSale.quantity=_)},{default:i(()=>[(m(!0),C(T,null,I(s.saleQuantities,_=>(m(),g(h,{label:_,value:_},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),Boolean(Number(s.iSale.is_fixed_price))?(m(),g(d,{key:0,label:"Amount",style:{width:"80px"}},{default:i(()=>[o(n,{disabled:"",modelValue:s.iSale.price,"onUpdate:modelValue":t[2]||(t[2]=_=>s.iSale.price=_)},null,8,["modelValue"])]),_:1})):k("",!0),Boolean(Number(s.iSale.is_fixed_price))?k("",!0):(m(),g(d,{key:1,label:"Amount",style:{width:"80px"}},{default:i(()=>[o(n,{modelValue:s.iSale.price,"onUpdate:modelValue":t[3]||(t[3]=_=>s.iSale.price=_)},null,8,["modelValue"])]),_:1})),o(d,{label:"Subtotal",style:{width:"80px"}},{default:i(()=>[o(n,{disabled:"",modelValue:l.subtotal,"onUpdate:modelValue":t[4]||(t[4]=_=>l.subtotal=_)},null,8,["modelValue"])]),_:1}),o(d,{label:"Tax",style:{width:"80px"}},{default:i(()=>[o(n,{disabled:"",modelValue:l.totalTax,"onUpdate:modelValue":t[5]||(t[5]=_=>l.totalTax=_)},null,8,["modelValue"])]),_:1}),o(d,{label:"Total",style:{width:"80px"}},{default:i(()=>[o(n,{disabled:"",modelValue:l.saleTotal,"onUpdate:modelValue":t[6]||(t[6]=_=>l.saleTotal=_)},null,8,["modelValue"])]),_:1})]),_:1})):k("",!0),s.iSale?(m(),g(S,{key:1,size:"small"},{default:i(()=>[o(d,{label:"Description"},{default:i(()=>[o(n,{modelValue:s.iSale.description,"onUpdate:modelValue":t[7]||(t[7]=_=>s.iSale.description=_)},null,8,["modelValue"])]),_:1})]),_:1})):k("",!0),l.saleTotal&&l.saleTotal>0||l.saleTotal<0?(m(),g(S,{key:2},{default:i(()=>[o(d,null,{default:i(()=>[o(u,{onClick:l.addToSale,size:"small",type:"success"},{default:i(()=>[w("Add to sale")]),_:1},8,["onClick"])]),_:1})]),_:1})):k("",!0)])}const ft=D(ht,[["render",_t]]),yt={name:"SaleItems",props:["saleItems"],emits:["sale-items:remove-at-index"],data(){return{}},computed:{saleItemsExist(){return this.saleItems.length>0}},methods:{handleRemoveItem(e){console.log(e),this.$emit("sale-items:remove-at-index",e.$index)}},watch:{saleItems(e){console.log("new prop on saleItems component",e)}}};function St(e,t,a,r,s,l){const n=c("el-table-column"),d=c("el-button"),h=c("el-table");return m(),g(h,{size:"small",data:a.saleItems,style:{width:"100%"}},{default:i(()=>[o(n,{prop:"saleTitle",width:"140",label:"Type"}),o(n,{prop:"description",label:"Description"}),o(n,{prop:"saleQuantity",width:"40",label:"Qty"}),o(n,{prop:"salePrice",width:"60",label:"Price"}),o(n,{prop:"saleSubtotal",width:"80",label:"Subtotal"}),o(n,{prop:"saleTax",width:"60",label:"Tax"}),o(n,{prop:"saleTotal",width:"60",label:"Total"}),o(n,{width:"40"},{default:i(f=>[o(d,{onClick:S=>l.handleRemoveItem(f),type:"danger",size:"small"},{default:i(()=>[w("X")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])}const gt=D(yt,[["render",St]]),vt={name:"CompleteSale",props:["saleItems"],emits:["compelete-sale:payment-type-selected"],data(){return{selectedPaymentType:null,testMode:!1}},computed:{activePaymentTypes(){return W().activePaymentTypes},saleItemsLength(){return this.saleItems.length},saleTotal(){let e=0;return b.each(this.saleItems,t=>{e+=Number(t.saleTotal)}),Number(e).toFixed(2)}},methods:{paymentTypeSelected(){console.log("p",this.selectedPaymentType),this.$emit("compelete-sale:payment-type-selected",this.selectedPaymentType)}}},kt={key:0},Ct=p("hr",null,null,-1),wt={style:{display:"flex"}};function bt(e,t,a,r,s,l){const n=c("el-option"),d=c("el-select"),h=c("el-button");return m(),C(T,null,[s.testMode?(m(),C("div",kt,[p("div",null,"sil: "+y(l.saleItemsLength),1),p("div",null,"t: "+y(l.saleTotal),1)])):k("",!0),Ct,p("div",wt,[p("span",null,"Total: "+y(l.saleTotal),1),o(d,{style:{"margin-left":"auto"},modelValue:s.selectedPaymentType,"onUpdate:modelValue":t[0]||(t[0]=f=>s.selectedPaymentType=f)},{default:i(()=>[(m(!0),C(T,null,I(l.activePaymentTypes,f=>(m(),g(n,{value:f.id,label:f.payment_title},null,8,["value","label"]))),256))]),_:1},8,["modelValue"]),s.selectedPaymentType?(m(),g(h,{key:0,onClick:l.paymentTypeSelected,type:"success",style:{"margin-left":"auto"}},{default:i(()=>[w("CompleteSale")]),_:1},8,["onClick"])):(m(),g(h,{key:1,disabled:"",type:"success",style:{"margin-left":"auto"}},{default:i(()=>[w("CompleteSale")]),_:1}))])],64)}const Rt=D(vt,[["render",bt]]),Pt={name:"FolioDisplay",props:["selectedReservation","folioViewerReloadKey"],data(){return{folioDataLoaded:!1,folioData:[]}},computed:{allSaleItems(){let e=[];return b.each(this.folioData.sale_items,t=>{e.push(t)}),e},allSalePayments(){let e=[];return b.each(this.folioData.payments,t=>{e.push(t)}),e},token(){return Y().token}},methods:{getFolio1(){x.folios.getFolio1(this.token,this.selectedReservation.folio).then(e=>{console.log(e.data),console.log(JSON.stringify(e.data)),this.folioData=e.data.folio_to_array,this.folioDataLoaded=!0})}},created(){console.log("folioDisplay created"),this.getFolio1()},watch:{folioViewerReloadKey(e){console.log("foliodispaly gets reload key"),this.folioData=[],this.folioDataLoaded=!1,this.getFolio1()}}},Dt={key:0,class:"folio-display-wrapper"},zt=p("div",{style:{"font-size":"1.5em"}},"Sale Items",-1),Tt=p("hr",null,null,-1),xt=p("div",{style:{"font-size":"1.5em"}},"Payments",-1);function Vt(e,t,a,r,s,l){const n=c("el-table-column"),d=c("el-table");return s.folioDataLoaded?(m(),C("div",Dt,[zt,o(d,{size:"small",data:l.allSaleItems,"max-height":"250",style:{width:"100%"},"show-summary":"",stripe:""},{default:i(()=>[o(n,{prop:"sale_datetime",width:"143",label:"Date"}),o(n,{prop:"description",label:"Description"}),o(n,{prop:"sale_quantity",width:"70",label:"Qty"}),o(n,{prop:"sale_price",width:"70",label:"Price"}),o(n,{prop:"sale_subtotal",width:"70",label:"Subtotal"}),o(n,{prop:"sale_tax",width:"70",label:"Tax"}),o(n,{prop:"sale_total",width:"70",label:"Total"})]),_:1},8,["data"]),Tt,xt,o(d,{size:"small",data:l.allSalePayments,"max-height":"250",style:{width:"100%"},"show-summary":"",stripe:""},{default:i(()=>[o(n,{prop:"datetime_posted",width:"143",label:"Date"}),o(n,{prop:"total",width:"70",label:"Total"}),o(n,{prop:"payment_type",width:"100",label:"Type"})]),_:1},8,["data"])])):k("",!0)}const It=D(Pt,[["render",Vt]]),Mt={name:"SaleGroupSelect",emits:["sale-group-select:group-selected"],computed:{groupSet(){let e=[];return b.each(this.saleTypeGroups,t=>{let a={};a.groupTitle=t.title,a.groupId=t.id;let r=b.filter(this.saleTypes,s=>s.sale_type_group==t.id);a.saleTypes=r,e.push(a)}),e},saleTypeGroups(){return J().saleTypeGroups},saleTypes(){return A().saleTypes}},methods:{handleGroupClick(e){console.log("group click",JSON.parse(JSON.stringify(e))),this.$emit("sale-group-select:group-selected",e)}}};function Yt(e,t,a,r,s,l){const n=c("el-button"),d=c("el-button-group");return m(),C("div",null,[o(d,{type:"primary"},{default:i(()=>[(m(!0),C(T,null,I(l.groupSet,h=>(m(),g(n,{size:"small",onClick:f=>l.handleGroupClick(h)},{default:i(()=>[w(y(h.groupTitle),1)]),_:2},1032,["onClick"]))),256))]),_:1})])}const Nt=D(Mt,[["render",Yt]]),Ft={name:"SaleTypeSelect",props:["selectedGroup"],emits:["sale-type-picker:sale-type-selected"],data(){return{}},methods:{handleSelectSaleType(e){this.$emit("sale-type-picker:sale-type-selected",e)}}};function Bt(e,t,a,r,s,l){const n=c("el-button"),d=c("el-button-group");return m(),g(d,null,{default:i(()=>[(m(!0),C(T,null,I(a.selectedGroup.saleTypes,h=>(m(),g(n,{type:"primary",size:"small",plain:"",onClick:f=>l.handleSelectSaleType(h)},{default:i(()=>[w(y(h.title),1)]),_:2},1032,["onClick"]))),256))]),_:1})}const Et=D(Ft,[["render",Bt]]);const Lt={name:"FolioView",props:["folioId","selectedReservation","componentKey"],components:{ProcessSaleType:ft,SaleItems:gt,CompleteSale:Rt,FolioViewer:It,SaleGroupSelect:Nt,SaleTypeSelect:Et},data(){return{folioViewerReloadKey:1,processSaleTypeResetKey:1,rootSpaces:[],saleItems:[],selectedPaymentType:null,selectedGroup:null,selectedSaleType:null}},computed:{rootSpace(){return b.find(this.rootSpaces,t=>t.id==this.selectedReservation.space_id)},saleSubtotal(){let e=0;return b.each(this.saleItems,t=>{e+=Number(t.saleSubtotal)}),e},saleTaxTotal(){let e=0;return b.each(this.saleItems,t=>{e+=Number(t.saleTax)}),e},saleTotal(){let e=0;return b.each(this.saleItems,t=>{e+=Number(t.saleTotal)}),Number(e).toFixed(2)},token(){return Y().token}},methods:{addSaleItem(e){console.log("addSaleItem: ",e),e.taxTypes=Object.values(e.taxTypes),this.saleItems.push(e),this.processSaleTypeResetKey+=1,this.saleTypePickerResetKey+=1,this.selectedSaleType=null,this.selectedGroup=null},groupSelected(e){console.log("setting i",JSON.parse(JSON.stringify(e))),this.selectedGroup=JSON.parse(JSON.stringify(e)),this.selectedSaleType=null},handlePaymentTypeSelected(e){if(this.selectedPaymentType=e,this.saleItems&&this.saleItems.length>0){console.log("here"),this.selectedReservation.id,this.selectedReservation.customer,this.selectedReservation.folioId;const t={resId:this.selectedReservation.id,resCustomer:this.selectedReservation.customer,resFolio:this.selectedReservation.folio,saleItems:this.saleItems,paymentType:e,saleTotal:this.saleTotal,saleSubtotal:this.saleSubtotal,saleTax:this.saleTaxTotal,soldBy:Y().account.id};console.log(t),console.log(JSON.stringify(t)),x.payments.postQuickFolioSale(t,this.token).then(a=>{console.log("quick sale",a.data),a.data.sale_items_posted&&a.data.payment_posted&&(N({type:"success",message:"Transaction completed"}),this.resetSale(),this.folioViewerReloadKey+=1)})}},removeItemAtIndex(e){console.log("rAI",e),this.saleItems.splice(e,1),this.selectedGroup=null},resetSale(){this.selectedGroup=null,this.selectedSaleType=null,this.saleItems=[]},saleTypeSelected(e){e=JSON.parse(JSON.stringify(e)),this.selectedSaleType=e,console.log(e)}},mounted(){z().showHideRootSpaceCopy?this.rootSpaces=z().showHideRootSpaceCopy:this.rootSpaces=E().rootSpaces},watch:{folioId(e){this.selectedSaleType=null}}},Kt=p("span",null," : ",-1),At={key:0},qt=p("hr",null,null,-1),Ut=p("hr",null,null,-1);function Qt(e,t,a,r,s,l){const n=c("el-button"),d=c("SaleGroupSelect"),h=c("SaleTypeSelect"),f=c("ProcessSaleType"),S=c("SaleItems"),u=c("CompleteSale"),_=c("el-col"),P=c("FolioViewer"),V=c("el-row");return m(),C("div",null,[o(V,null,{default:i(()=>[o(_,{span:12},{default:i(()=>[p("div",null,y(a.selectedReservation.customer_first)+"\xA0"+y(this.selectedReservation.customer_last),1),p("div",null,[p("span",null,y(a.selectedReservation.checkin),1),Kt,p("span",null,y(a.selectedReservation.checkout),1)]),l.rootSpace?(m(),C("div",At,y(e.$t("message.spaceLabel"))+": "+y(l.rootSpace.title),1)):k("",!0),p("div",null,y(e.$t("message.people"))+": "+y(a.selectedReservation.people),1),p("div",null,y(e.$t("message.beds"))+": "+y(a.selectedReservation.beds),1),qt,o(n,{type:"danger",size:"small",onClick:l.resetSale},{default:i(()=>[w("Reset Sale")]),_:1},8,["onClick"]),o(d,{"onSaleGroupSelect:groupSelected":l.groupSelected},null,8,["onSaleGroupSelect:groupSelected"]),s.selectedGroup?(m(),g(h,{key:1,selectedGroup:s.selectedGroup,"onSaleTypePicker:saleTypeSelected":l.saleTypeSelected},null,8,["selectedGroup","onSaleTypePicker:saleTypeSelected"])):k("",!0),Ut,o(f,{saleType:s.selectedSaleType,processSaleTypeResetKey:s.processSaleTypeResetKey,"onProcessSaleType:addSaleItem":l.addSaleItem},null,8,["saleType","processSaleTypeResetKey","onProcessSaleType:addSaleItem"]),s.saleItems.length>0?(m(),g(S,{key:2,saleItems:s.saleItems,"onSaleItems:removeAtIndex":l.removeItemAtIndex},null,8,["saleItems","onSaleItems:removeAtIndex"])):k("",!0),s.saleItems.length>0?(m(),g(u,{key:3,saleItems:s.saleItems,"onCompeleteSale:paymentTypeSelected":l.handlePaymentTypeSelected},null,8,["saleItems","onCompeleteSale:paymentTypeSelected"])):k("",!0)]),_:1}),o(_,{span:12},{default:i(()=>[o(P,{folioViewerReloadKey:s.folioViewerReloadKey,selectedReservation:a.selectedReservation},null,8,["folioViewerReloadKey","selectedReservation"])]),_:1})]),_:1})])}const Ot=D(Lt,[["render",Qt]]);const Ht={setup(){const{handleRequestError:e}=L();return{handleRequestError:e}},name:"ReservationView",props:["selectedReservation"],components:{EditReservation:mt,FolioView:Ot},emits:["reservation-view:close-view","reservation-view:update-reservations","reservation-view:update-selected-reservation"],data(){return{componentKey:1,rootSpaces:null,showHistory:!1,showFolioDialog:!1}},computed:{token(){return Y().token},rootSpace(){return b.find(this.rootSpaces,t=>t.id==this.selectedReservation.space_id)}},methods:{closeReservationView(){this.$emit("reservation-view:close-view")},modifyReservation1(e){console.log("reservationview gets command",e),x.reservations.modifyReservation1(e,this.token).then(t=>{(t.data.success=!0)?(this.$emit("reservation-view:update-reservations"),this.$emit("reservation-view:update-selected-reservation",t.data.current_res),this.componentKey+=1,N({type:"success",message:"Reservation updated"})):N({type:"warning",message:"There was an error"})}).catch(t=>{this.handleRequestError(t)})},reservationCheckin(){x.reservations.reservationCheckin(this.selectedReservation.id,this.token).then(e=>{e.data.checkin==!0&&e.data.reservation_after_checkin?(this.$emit("reservation-view:update-reservations"),this.$emit("reservation-view:update-selected-reservation",e.data.reservation_after_checkin),N({type:"success",message:"Reservation checked in"})):N({type:"warning",message:"There was an error"})}).catch(e=>{this.handleRequestError(e)})},reservationCheckout(){x.reservations.reservationCheckout(this.selectedReservation.id,this.token).then(e=>{console.log(e),e.data.checkout==!0&&e.data.reservation_after_checkout&&(this.$emit("reservation-view:update-reservations"),this.$emit("reservation-view:update-selected-reservation",e.data.reservation_after_checkout),N({type:"success",message:"Reservatin checked out"}))}).catch(e=>{this.handleRequestError(e)})}},mounted(){z().showHideRootSpaceCopy?this.rootSpaces=z().showHideRootSpaceCopy:this.rootSpaces=E().rootSpaces}},Gt={key:0,class:"wrapper"},jt=p("br",null,null,-1),$t=p("span",null," : ",-1),Wt={key:0},Jt={key:1},Xt={class:"historyTable"};function Zt(e,t,a,r,s,l){const n=c("FolioView"),d=c("el-dialog"),h=c("font-awesome-icon"),f=c("el-button"),S=c("EditReservation"),u=c("el-collapse-item"),_=c("el-collapse");return m(),C(T,null,[o(d,{modelValue:s.showFolioDialog,"onUpdate:modelValue":t[0]||(t[0]=P=>s.showFolioDialog=P),fullscreen:!0,"destroy-on-close":!0},{default:i(()=>[o(n,{folioId:a.selectedReservation.folio,selectedReservation:a.selectedReservation,componentKey:s.componentKey},null,8,["folioId","selectedReservation","componentKey"])]),_:1},8,["modelValue"]),s.rootSpaces&&l.rootSpace?(m(),C("div",Gt,[p("div",null,[o(h,{onClick:l.closeReservationView,color:"#f56c6c",icon:"fa-window-close",size:"xl",style:{float:"right"}},null,8,["onClick"])]),jt,p("div",null,y(a.selectedReservation.customer_first)+"\xA0"+y(this.selectedReservation.customer_last),1),p("div",null,[p("span",null,y(a.selectedReservation.checkin),1),$t,p("span",null,y(a.selectedReservation.checkout),1)]),p("div",null,y(e.$t("message.spaceLabel"))+": "+y(l.rootSpace.title),1),p("div",null,y(e.$t("message.people"))+": "+y(a.selectedReservation.people),1),p("div",null,y(e.$t("message.beds"))+": "+y(a.selectedReservation.beds),1),p("div",null,"Res Id : "+y(a.selectedReservation.id),1),p("div",null,[a.selectedReservation.status==0?(m(),C("span",Wt,[o(f,{type:"success",onClick:l.reservationCheckin},{default:i(()=>[w(y(e.$t("message.checkin")),1)]),_:1},8,["onClick"])])):k("",!0),a.selectedReservation.status==1?(m(),C("span",Jt,[o(f,{type:"info",onClick:l.reservationCheckout},{default:i(()=>[w(y(e.$t("message.checkout")),1)]),_:1},8,["onClick"])])):k("",!0),p("span",null,[o(f,{onClick:t[1]||(t[1]=P=>s.showFolioDialog=!0),type:"primary"},{default:i(()=>[w("Folio")]),_:1})])]),o(_,null,{default:i(()=>[o(u,{title:"Edit Reservation",name:"2"},{default:i(()=>[s.rootSpaces&&l.rootSpace?(m(),g(S,{key:0,componentKey:s.componentKey,resId:a.selectedReservation.id,checkin:a.selectedReservation.checkin,checkout:a.selectedReservation.checkout,people:a.selectedReservation.people,beds:a.selectedReservation.beds,spaceId:a.selectedReservation.space_id,customer:a.selectedReservation.customer,customerFirst:a.selectedReservation.first_name,customerLast:a.selectedReservation.last_name,"onEditReservation:modifyReservation1":l.modifyReservation1},null,8,["componentKey","resId","checkin","checkout","people","beds","spaceId","customer","customerFirst","customerLast","onEditReservation:modifyReservation1"])):k("",!0)]),_:1}),o(u,{title:"History",name:"1"},{default:i(()=>[p("table",Xt,[p("tbody",null,[(m(!0),C(T,null,I(a.selectedReservation.history,P=>(m(),C("tr",null,[p("td",null,y(P.text),1),p("td",null,y(P.account_name),1),p("td",null,y(P.date),1)]))),256))])])]),_:1})]),_:1})])):k("",!0)],64)}const es=D(Ht,[["render",Zt]]);var ts={exports:{}};(function(e,t){(function(a,r){e.exports=r(X.exports)})(Z,function(a){function r(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var s=r(a),l={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_mi\xE9rcoles_jueves_viernes_s\xE1bado".split("_"),weekdaysShort:"dom._lun._mar._mi\xE9._jue._vie._s\xE1b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s\xE1".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d\xEDa",dd:"%d d\xEDas",M:"un mes",MM:"%d meses",y:"un a\xF1o",yy:"%d a\xF1os"},ordinal:function(n){return n+"\xBA"}};return s.default.locale(l,null,!0),l})})(ts);const ss={name:"splitpanes",emits:["ready","resize","resized","pane-click","pane-maximize","pane-add","pane-remove","splitter-click"],props:{horizontal:{type:Boolean},pushOtherPanes:{type:Boolean,default:!0},dblClickSplitter:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean}},provide(){return{requestUpdate:this.requestUpdate,onPaneAdd:this.onPaneAdd,onPaneRemove:this.onPaneRemove,onPaneClick:this.onPaneClick}},data:()=>({container:null,ready:!1,panes:[],touch:{mouseDown:!1,dragging:!1,activeSplitter:null},splitterTaps:{splitter:null,timeoutId:null}}),computed:{panesCount(){return this.panes.length},indexedPanes(){return this.panes.reduce((e,t)=>(e[t.id]=t)&&e,{})}},methods:{updatePaneComponents(){this.panes.forEach(e=>{e.update&&e.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[e.id].size}%`})})},bindEvents(){document.addEventListener("mousemove",this.onMouseMove,{passive:!1}),document.addEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.addEventListener("touchmove",this.onMouseMove,{passive:!1}),document.addEventListener("touchend",this.onMouseUp))},unbindEvents(){document.removeEventListener("mousemove",this.onMouseMove,{passive:!1}),document.removeEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.removeEventListener("touchmove",this.onMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onMouseUp))},onMouseDown(e,t){this.bindEvents(),this.touch.mouseDown=!0,this.touch.activeSplitter=t},onMouseMove(e){this.touch.mouseDown&&(e.preventDefault(),this.touch.dragging=!0,this.calculatePanesSize(this.getCurrentMouseDrag(e)),this.$emit("resize",this.panes.map(t=>({min:t.min,max:t.max,size:t.size}))))},onMouseUp(){this.touch.dragging&&this.$emit("resized",this.panes.map(e=>({min:e.min,max:e.max,size:e.size}))),this.touch.mouseDown=!1,setTimeout(()=>{this.touch.dragging=!1,this.unbindEvents()},100)},onSplitterClick(e,t){"ontouchstart"in window&&(e.preventDefault(),this.dblClickSplitter&&(this.splitterTaps.splitter===t?(clearTimeout(this.splitterTaps.timeoutId),this.splitterTaps.timeoutId=null,this.onSplitterDblClick(e,t),this.splitterTaps.splitter=null):(this.splitterTaps.splitter=t,this.splitterTaps.timeoutId=setTimeout(()=>{this.splitterTaps.splitter=null},500)))),this.touch.dragging||this.$emit("splitter-click",this.panes[t])},onSplitterDblClick(e,t){let a=0;this.panes=this.panes.map((r,s)=>(r.size=s===t?r.max:r.min,s!==t&&(a+=r.min),r)),this.panes[t].size-=a,this.$emit("pane-maximize",this.panes[t]),this.$emit("resized",this.panes.map(r=>({min:r.min,max:r.max,size:r.size})))},onPaneClick(e,t){this.$emit("pane-click",this.indexedPanes[t])},getCurrentMouseDrag(e){const t=this.container.getBoundingClientRect(),{clientX:a,clientY:r}="ontouchstart"in window&&e.touches?e.touches[0]:e;return{x:a-t.left,y:r-t.top}},getCurrentDragPercentage(e){e=e[this.horizontal?"y":"x"];const t=this.container[this.horizontal?"clientHeight":"clientWidth"];return this.rtl&&!this.horizontal&&(e=t-e),e*100/t},calculatePanesSize(e){const t=this.touch.activeSplitter;let a={prevPanesSize:this.sumPrevPanesSize(t),nextPanesSize:this.sumNextPanesSize(t),prevReachedMinPanes:0,nextReachedMinPanes:0};const r=0+(this.pushOtherPanes?0:a.prevPanesSize),s=100-(this.pushOtherPanes?0:a.nextPanesSize),l=Math.max(Math.min(this.getCurrentDragPercentage(e),s),r);let n=[t,t+1],d=this.panes[n[0]]||null,h=this.panes[n[1]]||null;const f=d.max<100&&l>=d.max+a.prevPanesSize,S=h.max<100&&l<=100-(h.max+this.sumNextPanesSize(t+1));if(f||S){f?(d.size=d.max,h.size=Math.max(100-d.max-a.prevPanesSize-a.nextPanesSize,0)):(d.size=Math.max(100-h.max-a.prevPanesSize-this.sumNextPanesSize(t+1),0),h.size=h.max);return}if(this.pushOtherPanes){const u=this.doPushOtherPanes(a,l);if(!u)return;({sums:a,panesToResize:n}=u),d=this.panes[n[0]]||null,h=this.panes[n[1]]||null}d!==null&&(d.size=Math.min(Math.max(l-a.prevPanesSize-a.prevReachedMinPanes,d.min),d.max)),h!==null&&(h.size=Math.min(Math.max(100-l-a.nextPanesSize-a.nextReachedMinPanes,h.min),h.max))},doPushOtherPanes(e,t){const a=this.touch.activeSplitter,r=[a,a+1];return t<e.prevPanesSize+this.panes[r[0]].min&&(r[0]=this.findPrevExpandedPane(a).index,e.prevReachedMinPanes=0,r[0]<a&&this.panes.forEach((s,l)=>{l>r[0]&&l<=a&&(s.size=s.min,e.prevReachedMinPanes+=s.min)}),e.prevPanesSize=this.sumPrevPanesSize(r[0]),r[0]===void 0)?(e.prevReachedMinPanes=0,this.panes[0].size=this.panes[0].min,this.panes.forEach((s,l)=>{l>0&&l<=a&&(s.size=s.min,e.prevReachedMinPanes+=s.min)}),this.panes[r[1]].size=100-e.prevReachedMinPanes-this.panes[0].min-e.prevPanesSize-e.nextPanesSize,null):t>100-e.nextPanesSize-this.panes[r[1]].min&&(r[1]=this.findNextExpandedPane(a).index,e.nextReachedMinPanes=0,r[1]>a+1&&this.panes.forEach((s,l)=>{l>a&&l<r[1]&&(s.size=s.min,e.nextReachedMinPanes+=s.min)}),e.nextPanesSize=this.sumNextPanesSize(r[1]-1),r[1]===void 0)?(e.nextReachedMinPanes=0,this.panes[this.panesCount-1].size=this.panes[this.panesCount-1].min,this.panes.forEach((s,l)=>{l<this.panesCount-1&&l>=a+1&&(s.size=s.min,e.nextReachedMinPanes+=s.min)}),this.panes[r[0]].size=100-e.prevPanesSize-e.nextReachedMinPanes-this.panes[this.panesCount-1].min-e.nextPanesSize,null):{sums:e,panesToResize:r}},sumPrevPanesSize(e){return this.panes.reduce((t,a,r)=>t+(r<e?a.size:0),0)},sumNextPanesSize(e){return this.panes.reduce((t,a,r)=>t+(r>e+1?a.size:0),0)},findPrevExpandedPane(e){return[...this.panes].reverse().find(t=>t.index<e&&t.size>t.min)||{}},findNextExpandedPane(e){return this.panes.find(t=>t.index>e+1&&t.size>t.min)||{}},checkSplitpanesNodes(){Array.from(this.container.children).forEach(e=>{const t=e.classList.contains("splitpanes__pane"),a=e.classList.contains("splitpanes__splitter");!t&&!a&&(e.parentNode.removeChild(e),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed."))})},addSplitter(e,t,a=!1){const r=e-1,s=document.createElement("div");s.classList.add("splitpanes__splitter"),a||(s.onmousedown=l=>this.onMouseDown(l,r),typeof window<"u"&&"ontouchstart"in window&&(s.ontouchstart=l=>this.onMouseDown(l,r)),s.onclick=l=>this.onSplitterClick(l,r+1)),this.dblClickSplitter&&(s.ondblclick=l=>this.onSplitterDblClick(l,r+1)),t.parentNode.insertBefore(s,t)},removeSplitter(e){e.onmousedown=void 0,e.onclick=void 0,e.ondblclick=void 0,e.parentNode.removeChild(e)},redoSplitters(){const e=Array.from(this.container.children);e.forEach(a=>{a.className.includes("splitpanes__splitter")&&this.removeSplitter(a)});let t=0;e.forEach(a=>{a.className.includes("splitpanes__pane")&&(!t&&this.firstSplitter?this.addSplitter(t,a,!0):t&&this.addSplitter(t,a),t++)})},requestUpdate({target:e,...t}){const a=this.indexedPanes[e._.uid];Object.entries(t).forEach(([r,s])=>a[r]=s)},onPaneAdd(e){let t=-1;Array.from(e.$el.parentNode.children).some(s=>(s.className.includes("splitpanes__pane")&&t++,s===e.$el));const a=parseFloat(e.minSize),r=parseFloat(e.maxSize);this.panes.splice(t,0,{id:e._.uid,index:t,min:isNaN(a)?0:a,max:isNaN(r)?100:r,size:e.size===null?null:parseFloat(e.size),givenSize:e.size,update:e.update}),this.panes.forEach((s,l)=>s.index=l),this.ready&&this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({addedPane:this.panes[t]}),this.$emit("pane-add",{index:t,panes:this.panes.map(s=>({min:s.min,max:s.max,size:s.size}))})})},onPaneRemove(e){const t=this.panes.findIndex(r=>r.id===e._.uid),a=this.panes.splice(t,1)[0];this.panes.forEach((r,s)=>r.index=s),this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({removedPane:{...a,index:t}}),this.$emit("pane-remove",{removed:a,panes:this.panes.map(r=>({min:r.min,max:r.max,size:r.size}))})})},resetPaneSizes(e={}){!e.addedPane&&!e.removedPane?this.initialPanesSizing():this.panes.some(t=>t.givenSize!==null||t.min||t.max<100)?this.equalizeAfterAddOrRemove(e):this.equalize(),this.ready&&this.$emit("resized",this.panes.map(t=>({min:t.min,max:t.max,size:t.size})))},equalize(){const e=100/this.panesCount;let t=0;const a=[],r=[];this.panes.forEach(s=>{s.size=Math.max(Math.min(e,s.max),s.min),t-=s.size,s.size>=s.max&&a.push(s.id),s.size<=s.min&&r.push(s.id)}),t>.1&&this.readjustSizes(t,a,r)},initialPanesSizing(){let e=100;const t=[],a=[];let r=0;this.panes.forEach(l=>{e-=l.size,l.size!==null&&r++,l.size>=l.max&&t.push(l.id),l.size<=l.min&&a.push(l.id)});let s=100;e>.1&&(this.panes.forEach(l=>{l.size===null&&(l.size=Math.max(Math.min(e/(this.panesCount-r),l.max),l.min)),s-=l.size}),s>.1&&this.readjustSizes(e,t,a))},equalizeAfterAddOrRemove({addedPane:e,removedPane:t}={}){let a=100/this.panesCount,r=0;const s=[],l=[];e&&e.givenSize!==null&&(a=(100-e.givenSize)/(this.panesCount-1)),this.panes.forEach(n=>{r-=n.size,n.size>=n.max&&s.push(n.id),n.size<=n.min&&l.push(n.id)}),!(Math.abs(r)<.1)&&(this.panes.forEach(n=>{e&&e.givenSize!==null&&e.id===n.id||(n.size=Math.max(Math.min(a,n.max),n.min)),r-=n.size,n.size>=n.max&&s.push(n.id),n.size<=n.min&&l.push(n.id)}),r>.1&&this.readjustSizes(r,s,l))},readjustSizes(e,t,a){let r;e>0?r=e/(this.panesCount-t.length):r=e/(this.panesCount-a.length),this.panes.forEach((s,l)=>{if(e>0&&!t.includes(s.id)){const n=Math.max(Math.min(s.size+r,s.max),s.min),d=n-s.size;e-=d,s.size=n}else if(!a.includes(s.id)){const n=Math.max(Math.min(s.size+r,s.max),s.min),d=n-s.size;e-=d,s.size=n}s.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[s.id].size}%`})}),Math.abs(e)>.1&&this.$nextTick(()=>{this.ready&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})}},watch:{panes:{deep:!0,immediate:!1,handler(){this.updatePaneComponents()}},horizontal(){this.updatePaneComponents()},firstSplitter(){this.redoSplitters()},dblClickSplitter(e){[...this.container.querySelectorAll(".splitpanes__splitter")].forEach((t,a)=>{t.ondblclick=e?r=>this.onSplitterDblClick(r,a):void 0})}},beforeUnmount(){this.ready=!1},mounted(){this.container=this.$refs.container,this.checkSplitpanesNodes(),this.redoSplitters(),this.resetPaneSizes(),this.$emit("ready"),this.ready=!0},render(){return ee("div",{ref:"container",class:["splitpanes",`splitpanes--${this.horizontal?"horizontal":"vertical"}`,{"splitpanes--dragging":this.touch.dragging}]},this.$slots.default())}},ls=(e,t)=>{const a=e.__vccOpts||e;for(const[r,s]of t)a[r]=s;return a},as={name:"pane",inject:["requestUpdate","onPaneAdd","onPaneRemove","onPaneClick"],props:{size:{type:[Number,String],default:null},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},data:()=>({style:{}}),mounted(){this.onPaneAdd(this)},beforeUnmount(){this.onPaneRemove(this)},methods:{update(e){this.style=e}},computed:{sizeNumber(){return this.size||this.size===0?parseFloat(this.size):null},minSizeNumber(){return parseFloat(this.minSize)},maxSizeNumber(){return parseFloat(this.maxSize)}},watch:{sizeNumber(e){this.requestUpdate({target:this,size:e})},minSizeNumber(e){this.requestUpdate({target:this,min:e})},maxSizeNumber(e){this.requestUpdate({target:this,max:e})}}};function os(e,t,a,r,s,l){return m(),C("div",{class:"splitpanes__pane",onClick:t[0]||(t[0]=n=>l.onPaneClick(n,e._.uid)),style:se(e.style)},[te(e.$slots,"default")],4)}const ns=ls(as,[["render",os]]);const rs={setup(){const{handleRequestError:e}=L();return{handleRequestError:e}},name:"resView3",components:{singleDatePicker:oe,ResViewTable:Fe,CreateReservation:nt,ReservationView:es,Splitpanes:ss,Pane:ns},data(){return{leftPaneSize:30,overRideSingleDatePicker:"",reservationDialog:!1,reservations:[],rootSpaces:null,selectedReservation:null,showCreateReservation:!0,showReservationView:!1,trigger:1,windowHeight:0,windowWidth:0,componentTrigger:0}},computed:{locale(){return F().selectedLocale},token(){return Y().token},rDrawerWidth(){if(this.windowWidth<768)return"100%";if(this.windowWidth>768&&this.windowWidth<1200)return"500px";if(this.windowWidth>=1200)return"35%"},resViewEndDate(){return v(this.resViewStartDate).add(31,"days").format("YYYY-MM-DD")},resViewStartDate(){return z().startDate},resTableData(){let e,t,a,r,s,l,n;return b.each(this.rootSpaces,d=>{const h=Object.keys(d);b.each(h,f=>{f.substring(0,1)=="D"&&delete d[f]})}),n=this.rootSpaces,b.each(this.reservations,d=>{if(d.checkout!=this.resViewStartDate){let h=b.find(n,f=>f.id==d.space_id);if(h){v(d.checkout).isAfter(v(this.resViewEndDate))?r=!1:r=!0,v(d.checkin).isBefore(v(this.resViewStartDate))?(a=!1,e=v(this.resViewStartDate).format("YYYYMMDD"),t=v(this.resViewStartDate).format("YYYY-MM-DD"),v(d.checkout).diff(v(this.resViewStartDate),"d")):(a=!0,e=v(d.checkin).format("YYYYMMDD"),t=v(d.checkin).format("YYYY-MM-DD"),v(d.checkout).diff(v(d.checkin),"d"));let f=v(d.checkout).diff(v(t),"d");for(let S=0;S<f;S++){let u=v(e).add(S,"d").format("YYYYMMDD");S==0&&(s="D"+u+"isfirst",h[s]=!0),v(this.resViewEndDate).isSame(u)&&(s="D"+u+"islast",h[s]=!0),s="D"+u+"blocked",h[s]=!1,s="D"+u+"starttruncated",h[s]=!a,s="D"+u+"endtruncated",h[s]=!r,s="D"+u+"resid",h[s]=d.id,s="D"+u+"start",h[s]=d.checkin,s="D"+u+"end",h[s]=d.checkout,s="D"+u+"customer",h[s]=d.customer_last,s="D"+u+"status",h[s]=d.status}}h.children.length>0&&b.forEach(h.children,f=>{let S=b.find(n,u=>u.id==f);if(S){let u=v(d.checkout).diff(v(t),"d");for(let _=0;_<u;_++){let P=v(e).add(_,"d").format("YYYYMMDD");if(l="D"+P+"blocked",!S[l]){let V="D"+P+"blocked";S[V]=!0,V="D"+P+"span",S[V]=1,V="D"+P+"resIdRef",S[V]=d.id}}}}),h.parents.length>0&&b.forEach(h.parents,f=>{let S=b.find(n,u=>u.id==f);if(S){let u=v(d.checkout).diff(v(t),"d");for(let _=0;_<u;_++){let P=v(e).add(_,"d").format("YYYYMMDD"),V="D"+P+"blocked";if(!S[V]){let R="D"+P+"blocked";S[R]=!0,R="D"+P+"span",S[R]=1,R="D"+P+"resIdRef",S[R]=d.id}}}})}}),n},tableHeight(){return this.windowHeight-110},tDateArray(){v.locale(this.locale.name);const e=[];for(let t=0;t<32;t++){let a={dayString:"D"+v(this.resViewStartDate).add(t,"day").format("YYYYMMDD"),dayLabel:v(this.resViewStartDate).add(t,"day").format("ddd MMM D")};e.push(a)}return e}},methods:{clearReservations(){},closeReservationView(){this.showCreateReservation=!0,this.showReservationView=!1},emptyCellClick(e){console.log("empty cell selected",e)},getReservations(){x.reservations.getReservationsByRange(this.resViewStartDate,this.resViewEndDate,this.token).then(e=>{console.log("res fetch from rv3 getR()"),this.reservations=e.data.reservations,this.componentTrigger+=1}).catch(e=>{this.handleRequestError(e),this.reservations=[]})},leftPane100(){this.leftPaneSize=100},leftPane30(){this.leftPaneSize=30},leftPane50(){this.leftPaneSize=50},leftPane70(){this.leftPaneSize=70},leftPane10(){this.leftPaneSize=5},leftResize(e){console.log(e)},reservationSelected(e){this.selectedReservation=b.find(this.reservations,function(t){return t.id==e}),this.showCreateReservation=!1,this.showReservationView=!0},rowClassName(e){},showCreateReservationFtn(){this.showCreateReservation=!0,this.showReservationView=!1},singleDateSelected(e){let t=v(e).format("YYYY-MM-DD");z().startDate=t,this.getReservations()},toggleShowChildren(e){let t=b.find(this.rootSpaces,s=>s.id==e),a=s=>{s.showChildren=!1,s.children&&b.each(s.children,l=>{let n=b.find(this.spaceRecords,d=>d.id==l);n&&a(n)})};(s=>{s.showChildren==!0?(s.showChildren=!1,s.children&&b.each(s.children,l=>{let n=b.find(this.spaceRecords,d=>d.id==l);n&&a(n)})):s.showChildren=!0})(t),z().setShowHideRootSpaceCopy(this.rootSpaces)},toggleCreateReservationDrawer(){this.showCreateReservationDrawer=!this.showCreateReservationDrawer},updateSelectedReservation(e){this.selectedReservation=e},viewBack1(){const e=v(z().startDate).subtract(1,"days").format("YYYY-MM-DD");this.overRideSingleDatePicker=e},viewBack7(){const e=v(z().startDate).subtract(7,"days").format("YYYY-MM-DD");this.overRideSingleDatePicker=e},viewForward1(){const e=v(z().startDate).add(1,"days").format("YYYY-MM-DD");this.overRideSingleDatePicker=e},viewForward7(){const e=v(z().startDate).add(7,"days").format("YYYY-MM-DD");this.overRideSingleDatePicker=e}},created(){v.extend(v),v.extend(v),this.spaceRecords={}},mounted(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,window.addEventListener("resize",e=>{this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight},!0),z().showHideRootSpaceCopy?this.rootSpaces=z().showHideRootSpaceCopy:this.rootSpaces=E().rootSpaces,this.getReservations()}},is={style:{display:"flex","flex-direction":"row-reverse"}},cs={style:{"margin-left":"4px"}};function ds(e,t,a,r,s,l){const n=c("el-button"),d=c("el-button-group"),h=c("CreateReservation"),f=c("ReservationView"),S=c("pane"),u=c("singleDatePicker"),_=c("ResViewTable"),P=c("splitpanes");return m(),g(P,{onResized:l.leftResize},{default:i(()=>[o(S,{size:s.leftPaneSize},{default:i(()=>[p("div",is,[o(d,null,{default:i(()=>[o(n,{type:"warning",onClick:l.leftPane10},{default:i(()=>[w("<<")]),_:1},8,["onClick"]),o(n,{type:"warning",onClick:l.leftPane30},{default:i(()=>[w("<")]),_:1},8,["onClick"]),o(n,{type:"warning",onClick:l.leftPane50},{default:i(()=>[w("|")]),_:1},8,["onClick"]),o(n,{type:"warning",onClick:l.leftPane70},{default:i(()=>[w(">")]),_:1},8,["onClick"]),o(n,{type:"warning",onClick:l.leftPane100},{default:i(()=>[w(">>")]),_:1},8,["onClick"])]),_:1})]),s.showCreateReservation?(m(),g(h,{key:0,"onCreateReservation:reloadReservations":l.getReservations},null,8,["onCreateReservation:reloadReservations"])):k("",!0),s.showReservationView?(m(),g(f,{key:1,selectedReservation:s.selectedReservation,"onReservationView:closeView":l.closeReservationView,"onReservationView:updateReservations":l.getReservations,"onReservationView:updateSelectedReservation":l.updateSelectedReservation},null,8,["selectedReservation","onReservationView:closeView","onReservationView:updateReservations","onReservationView:updateSelectedReservation"])):k("",!0)]),_:1},8,["size"]),o(S,{size:100-s.leftPaneSize},{default:i(()=>[p("div",cs,[p("span",null,[o(d,null,{default:i(()=>[o(n,{type:"warning",onClick:l.viewBack7},{default:i(()=>[w("-7")]),_:1},8,["onClick"]),o(n,{type:"warning",onClick:l.viewBack1},{default:i(()=>[w("-1")]),_:1},8,["onClick"])]),_:1}),o(u,{overrideDate:s.overRideSingleDatePicker,"onSingleDatePicker:dateSelected":l.singleDateSelected},null,8,["overrideDate","onSingleDatePicker:dateSelected"]),o(d,null,{default:i(()=>[o(n,{type:"warning",onClick:l.viewForward1},{default:i(()=>[w("+1")]),_:1},8,["onClick"]),o(n,{type:"warning",onClick:l.viewForward7},{default:i(()=>[w("+7")]),_:1},8,["onClick"])]),_:1}),w("\xA0 "),o(n,{type:"success",onClick:l.showCreateReservationFtn},{default:i(()=>[w(y(e.$t("message.createReservation")),1)]),_:1},8,["onClick"])]),s.rootSpaces?(m(),g(_,{key:0,onResBlockClick:l.reservationSelected,onResviewToggleShowChildren:l.toggleShowChildren,onEmptyCellClick:l.emptyCellClick,tDateArray:l.tDateArray,tableData:l.resTableData,trigger:s.trigger,resSpaceCopy:e.spaceRecords,tableHeight:l.tableHeight},null,8,["onResBlockClick","onResviewToggleShowChildren","onEmptyCellClick","tDateArray","tableData","trigger","resSpaceCopy","tableHeight"])):k("",!0)])]),_:1},8,["size"])]),_:1},8,["onResized"])}const ms=D(rs,[["render",ds]]);export{ms as default};
